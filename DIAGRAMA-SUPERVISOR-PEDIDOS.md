# ๐ DIAGRAMA - ROL SUPERVISOR_PEDIDOS

## ๐๏ธ Arquitectura General

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    SUPERVISOR_PEDIDOS                       โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              RUTAS (web.php)                         โ  โ
โ  โ  GET    /supervisor-pedidos/                         โ  โ
โ  โ  GET    /supervisor-pedidos/{id}                     โ  โ
โ  โ  GET    /supervisor-pedidos/{id}/pdf                 โ  โ
โ  โ  POST   /supervisor-pedidos/{id}/anular              โ  โ
โ  โ  PATCH  /supervisor-pedidos/{id}/estado              โ  โ
โ  โ  GET    /supervisor-pedidos/{id}/datos               โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                           โ                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ         CONTROLLER                                   โ  โ
โ  โ  SupervisorPedidosController.php                     โ  โ
โ  โ                                                      โ  โ
โ  โ  - index()           โ Listar รณrdenes               โ  โ
โ  โ  - show()            โ Ver detalle                  โ  โ
โ  โ  - descargarPDF()    โ Generar PDF                  โ  โ
โ  โ  - anular()          โ Anular orden                 โ  โ
โ  โ  - cambiarEstado()   โ Cambiar estado               โ  โ
โ  โ  - obtenerDatos()    โ JSON                         โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                           โ                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ         VISTAS (Blade)                               โ  โ
โ  โ                                                      โ  โ
โ  โ  โโ index.blade.php                                 โ  โ
โ  โ  โ  โโ Tabla de รณrdenes                             โ  โ
โ  โ  โ  โโ Filtros avanzados                            โ  โ
โ  โ  โ  โโ Modal Ver Orden                              โ  โ
โ  โ  โ  โโ Modal Anulaciรณn                              โ  โ
โ  โ  โ                                                  โ  โ
โ  โ  โโ pdf.blade.php                                   โ  โ
โ  โ     โโ Header con logo                              โ  โ
โ  โ     โโ Informaciรณn general                          โ  โ
โ  โ     โโ Tabla de prendas                             โ  โ
โ  โ     โโ Firmas                                       โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                           โ                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ         COMPONENTES                                  โ  โ
โ  โ                                                      โ  โ
โ  โ  โโ Sidebar personalizado                           โ  โ
โ  โ  โ  โโ Menรบ principal                               โ  โ
โ  โ  โ  โโ Filtros rรกpidos                              โ  โ
โ  โ  โ  โโ Informaciรณn de usuario                       โ  โ
โ  โ  โ  โโ Botรณn logout                                 โ  โ
โ  โ  โ                                                  โ  โ
โ  โ  โโ Layout heredado (asesores.layout)               โ  โ
โ  โ     โโ Header                                       โ  โ
โ  โ     โโ Navegaciรณn                                   โ  โ
โ  โ     โโ Footer                                       โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                           โ                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ         BASE DE DATOS                                โ  โ
โ  โ                                                      โ  โ
โ  โ  Tabla: pedidos_produccion                          โ  โ
โ  โ  โโ id                                               โ  โ
โ  โ  โโ numero_pedido                                    โ  โ
โ  โ  โโ cliente                                          โ  โ
โ  โ  โโ asesora                                          โ  โ
โ  โ  โโ forma_de_pago                                    โ  โ
โ  โ  โโ estado                                           โ  โ
โ  โ  โโ fecha_de_creacion_de_orden                       โ  โ
โ  โ  โโ fecha_estimada_entrega                           โ  โ
โ  โ  โโ total                                            โ  โ
โ  โ  โโ motivo_anulacion                                 โ  โ
โ  โ  โโ usuario_anulacion                                โ  โ
โ  โ  โโ fecha_anulacion                                  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Datos

### 1. Listar รrdenes
```
Usuario accede a /supervisor-pedidos/
         โ
Middleware verifica autenticaciรณn y rol
         โ
Controller::index() obtiene รณrdenes
         โ
Aplica filtros (estado, cliente, asesora, fechas)
         โ
Pagina resultados (15 por pรกgina)
         โ
Retorna vista con tabla
         โ
Usuario ve tabla de รณrdenes
```

### 2. Ver Detalle
```
Usuario hace clic en botรณn "Ver"
         โ
JavaScript abre modal
         โ
Fetch a /supervisor-pedidos/{id}/datos
         โ
Controller::obtenerDatos() retorna JSON
         โ
JavaScript renderiza modal con datos
         โ
Usuario ve detalles completos
```

### 3. Descargar PDF
```
Usuario hace clic en botรณn "PDF"
         โ
GET /supervisor-pedidos/{id}/pdf
         โ
Controller::descargarPDF() carga datos
         โ
Genera PDF con DomPDF
         โ
Retorna descarga
         โ
Usuario descarga archivo PDF
```

### 4. Anular Orden
```
Usuario hace clic en botรณn "Anular"
         โ
Modal de confirmaciรณn se abre
         โ
Usuario ingresa motivo (10-500 caracteres)
         โ
Contador de caracteres se actualiza
         โ
Usuario hace clic en "Confirmar Anulaciรณn"
         โ
POST /supervisor-pedidos/{id}/anular
         โ
Validaciรณn de motivo
         โ
Controller::anular() actualiza BD
         โ
Registra log de auditorรญa
         โ
Retorna JSON con รฉxito
         โ
JavaScript recarga pรกgina
         โ
Orden aparece con estado "Anulada"
```

---

## ๐จ Estructura de Componentes

### Tabla de รrdenes
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ID ORDEN โ CLIENTE โ FECHA โ TOTAL โ ESTADO โ ACCIONES   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ #ORD-001 โ Juan   โ 03/12 โ $150  โ โ OK   โ ๐ ๐ โ  โ
โ #ORD-002 โ Marรญa  โ 02/12 โ $200  โ โณ Procโ ๐ ๐ โ  โ
โ #ORD-003 โ Pedro  โ 01/12 โ $300  โ โ Anulโ ๐ ๐     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Filtros
```
โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโ
โ Estado       โ โ Cliente      โ โ Asesora      โ
โ โผ            โ โ [Buscar...]  โ โ [Buscar...]  โ
โ No iniciado  โ โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโ
โ En Ejecuciรณn โ
โ Entregado    โ โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโ
โ Anulada      โ โ Desde        โ โ Hasta        โ
โโโโโโโโโโโโโโโโ โ [Fecha]      โ โ [Fecha]      โ
                 โโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโ

[Filtrar] [Limpiar]
```

### Modal Ver Orden
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Detalle de Orden                    [X] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                         โ
โ Nรบmero: #ORD-001                        โ
โ Cliente: Juan Pรฉrez                     โ
โ Asesora: Marรญa Garcรญa                   โ
โ Fecha: 03/12/2025                       โ
โ Estado: En Ejecuciรณn                    โ
โ Forma Pago: Efectivo                    โ
โ                                         โ
โ PRENDAS:                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ Prenda โ Cant โ Descripciรณn        โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค โ
โ โ CAMISA โ 50   โ Drill naranja      โ โ
โ โ PANTALรNโ 30  โ Drill azul         โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Modal Anulaciรณn
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         โ๏ธ  ยฟAnular Orden #ORD-001?     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                          โ
โ Esta acciรณn cancelarรก la orden y no      โ
โ se podrรก revertir.                       โ
โ                                          โ
โ Motivo de anulaciรณn *                    โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ Ej: El cliente solicitรณ reembolso... โ โ
โ โ                                      โ โ
โ โ                                      โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ 0/500 caracteres                         โ
โ                                          โ
โ [Cancelar] [Confirmar Anulaciรณn]        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฑ Responsividad

### Desktop (1200px+)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Sidebar โ Tabla completa con todas las columnas    โ
โ         โ Filtros en una fila                      โ
โ         โ Modales grandes                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Tablet (768px - 1199px)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Sidebar โ Tabla con scroll       โ
โ (80px)  โ Filtros apilados       โ
โ         โ Modales medianos       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Mobile (< 768px)
```
โโโโโโโโโโโโโโโโ
โ โฐ Sidebar    โ
โ (Colapsado)  โ
โโโโโโโโโโโโโโโโค
โ Tabla scroll โ
โ Filtros      โ
โ apilados     โ
โ              โ
โ Modales      โ
โ full-width   โ
โโโโโโโโโโโโโโโโ
```

---

## ๐ Seguridad

### Middleware
```
Usuario accede a /supervisor-pedidos/
         โ
Middleware 'auth' verifica autenticaciรณn
         โ
Middleware 'role:supervisor_pedidos,admin' verifica rol
         โ
Si OK โ Continรบa
Si NO โ Redirige a login con mensaje
```

### Validaciรณn de Anulaciรณn
```
Usuario ingresa motivo
         โ
JavaScript valida:
  - No vacรญo
  - Mรญnimo 10 caracteres
  - Mรกximo 500 caracteres
         โ
Si OK โ Habilita botรณn "Confirmar"
Si NO โ Deshabilita botรณn
         โ
Backend valida nuevamente
         โ
Si OK โ Guarda en BD
Si NO โ Retorna error
```

---

## ๐ Estados de Orden

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ESTADOS DE ORDEN                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                         โ
โ No iniciado โโโ En Ejecuciรณn           โ
โ   (Gris)         (Amarillo)             โ
โ                      โ                  โ
โ                 Entregado               โ
โ                 (Verde)                 โ
โ                      โ                  โ
โ                 Anulada                 โ
โ                 (Rojo)                  โ
โ                                         โ
โ O en cualquier momento:                 โ
โ Cualquier estado โโโ Anulada            โ
โ                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐๏ธ Estructura de Archivos

```
proyecto/
โโโ app/
โ   โโโ Http/
โ       โโโ Controllers/
โ           โโโ SupervisorPedidosController.php โจ
โ
โโโ resources/
โ   โโโ views/
โ       โโโ supervisor-pedidos/
โ       โ   โโโ index.blade.php โจ
โ       โ   โโโ pdf.blade.php โจ
โ       โโโ components/
โ           โโโ sidebars/
โ               โโโ sidebar-supervisor-pedidos.blade.php โจ
โ
โโโ routes/
โ   โโโ web.php (modificado) โ๏ธ
โ
โโโ docs/
    โโโ SUPERVISOR-PEDIDOS-IMPLEMENTACION.md โจ
    โโโ ACTIVAR-SUPERVISOR-PEDIDOS.md โจ
    โโโ RESUMEN-SUPERVISOR-PEDIDOS.md โจ
    โโโ DIAGRAMA-SUPERVISOR-PEDIDOS.md โจ

โจ = Nuevo
โ๏ธ = Modificado
```

---

## ๐ฏ Puntos de Entrada

```
Usuario con rol supervisor_pedidos
         โ
Accede a: http://localhost:8000/supervisor-pedidos/
         โ
Ve tabla de รณrdenes
         โ
Puede:
  โโ Filtrar รณrdenes
  โโ Ver detalles (modal)
  โโ Descargar PDF
  โโ Anular orden
  โโ Cambiar estado
```

---

## ๐ Flujo de Datos Completo

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ USUARIO                                                 โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ NAVEGADOR (Frontend)                                    โ
โ - HTML/CSS/JavaScript                                   โ
โ - Modales                                               โ
โ - Filtros                                               โ
โ - Validaciones                                          โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ HTTP Request
                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ LARAVEL (Backend)                                       โ
โ - Middleware (auth, role)                               โ
โ - Controller (SupervisorPedidosController)              โ
โ - Validaciones                                          โ
โ - Logs                                                  โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ BASE DE DATOS (MySQL)                                   โ
โ - Tabla: pedidos_produccion                             โ
โ - Tabla: roles                                          โ
โ - Tabla: users                                          โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ Datos
                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ RESPUESTA (JSON/HTML/PDF)                               โ
โ - Datos formateados                                     โ
โ - Errores validados                                     โ
โ - Logs registrados                                      โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ NAVEGADOR (Frontend)                                    โ
โ - Renderiza tabla/modal                                 โ
โ - Descarga PDF                                          โ
โ - Muestra mensajes                                      โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ USUARIO VE RESULTADO                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

**Fecha**: Diciembre 2025
**Versiรณn**: 1.0
**Estado**: โ COMPLETADO
