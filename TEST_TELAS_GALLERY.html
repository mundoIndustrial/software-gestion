<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - GalerÃ­a de Telas</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL@20..48,100..700,0..1" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f3f4f6;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #1f2937;
            margin-bottom: 2rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        thead {
            background: #f3f4f6;
            border-bottom: 2px solid #e5e7eb;
        }
        
        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #374151;
        }
        
        td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #0066cc;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0052a3;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        
        input[type="text"],
        input[type="file"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        input[type="text"]:focus,
        input[type="file"]:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0,102,204,0.1);
        }
        
        .test-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .test-info {
            background: #ecf0ff;
            border-left: 4px solid #0066cc;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            color: #1f2937;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§ª Test - GalerÃ­a de Telas con Aislamiento por Tela</h1>
        
        <div class="test-section">
            <h2>ðŸ“‹ Instrucciones del Test</h2>
            <div class="test-info">
                <strong>Paso 1:</strong> Completa los datos de la primera tela (Tela 1)<br>
                <strong>Paso 2:</strong> Sube 3 imÃ¡genes para Tela 1<br>
                <strong>Paso 3:</strong> Haz clic en "Agregar Tela 1"<br>
                <strong>Paso 4:</strong> Completa los datos de la segunda tela (Tela 2)<br>
                <strong>Paso 5:</strong> Sube 2 imÃ¡genes para Tela 2<br>
                <strong>Paso 6:</strong> Haz clic en "Agregar Tela 2"<br>
                <strong>Paso 7:</strong> Verifica que ambas telas aparezcan en la tabla con sus imÃ¡genes<br>
                <strong>Paso 8:</strong> Haz clic en la imagen de Tela 1 para abrir la galerÃ­a<br>
                <strong>Paso 9:</strong> Elimina 1 imagen de Tela 1 y verifica que Tela 2 no cambie<br>
                <strong>Paso 10:</strong> Verifica en la consola del navegador los logs de eliminaciÃ³n
            </div>
        </div>
        
        <div class="test-section">
            <h2>âž• Agregar Nueva Tela</h2>
            
            <div class="form-group">
                <label for="nueva-prenda-tela">Nombre de la Tela:</label>
                <input type="text" id="nueva-prenda-tela" placeholder="Ej: AlgodÃ³n, PoliÃ©ster, etc.">
            </div>
            
            <div class="form-group">
                <label for="nueva-prenda-color">Color:</label>
                <input type="text" id="nueva-prenda-color" placeholder="Ej: Rojo, Azul, etc.">
            </div>
            
            <div class="form-group">
                <label for="nueva-prenda-referencia">Referencia:</label>
                <input type="text" id="nueva-prenda-referencia" placeholder="Ej: REF-001">
            </div>
            
            <div class="form-group">
                <label for="nueva-prenda-tela-imagen">Seleccionar Imagen:</label>
                <input type="file" id="nueva-prenda-tela-imagen" accept="image/*">
            </div>
            
            <div id="nueva-prenda-tela-preview" style="display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap;"></div>
            
            <button class="btn btn-primary" onclick="agregarTelaNueva()">Agregar Tela</button>
            <button class="btn btn-secondary" onclick="limpiarFormulario()">Limpiar Formulario</button>
        </div>
        
        <div class="test-section">
            <h2>ðŸ“Š Telas Agregadas</h2>
            <table>
                <thead>
                    <tr>
                        <th>Tela</th>
                        <th>Color</th>
                        <th>Referencia</th>
                        <th>ImÃ¡genes</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="tbody-telas">
                    <tr id="fila-inputs" style="background: #f9fafb;">
                        <td colspan="5" style="text-align: center; color: #9ca3af;">
                            Completa el formulario anterior para agregar telas
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Scripts para storage temporal de imÃ¡genes de tela -->
    <script>
        /**
         * Storage temporal para imÃ¡genes mientras se estÃ¡ agregando una tela nueva
         */
        window.imagenesTelaStorage = {
            imagenes: [],
            
            agregarImagen: function(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        const previewUrl = URL.createObjectURL(file);
                        this.imagenes.push({
                            file: file,
                            nombre: file.name,
                            tamaÃ±o: (file.size / 1024).toFixed(2) + ' KB',
                            previewUrl: previewUrl
                        });
                        console.log('âœ… [STORAGE] Imagen agregada. Total:', this.imagenes.length);
                        resolve();
                    };
                    
                    reader.onerror = (err) => {
                        reject(new Error('Error al leer el archivo'));
                    };
                    
                    reader.readAsArrayBuffer(file);
                });
            },
            
            obtenerImagenes: function() {
                return this.imagenes;
            },
            
            limpiar: function() {
                console.log('ðŸ§¹ [STORAGE] Limpiando storage temporal. Total antes:', this.imagenes.length);
                this.imagenes.forEach(img => {
                    if (img.previewUrl && img.previewUrl.startsWith('blob:')) {
                        URL.revokeObjectURL(img.previewUrl);
                    }
                });
                this.imagenes = [];
                console.log('âœ… [STORAGE] Storage limpiado');
            }
        };
    </script>
    
    <!-- Script principal de gestiÃ³n de telas -->
    <script src="public/js/modulos/crear-pedido/telas/gestion-telas.js"></script>
    
    <script>
        // FunciÃ³n adicional para limpiar formulario
        window.limpiarFormulario = function() {
            document.getElementById('nueva-prenda-tela').value = '';
            document.getElementById('nueva-prenda-color').value = '';
            document.getElementById('nueva-prenda-referencia').value = '';
            document.getElementById('nueva-prenda-tela-imagen').value = '';
            window.imagenesTelaStorage.limpiar();
            document.getElementById('nueva-prenda-tela-preview').innerHTML = '';
        };
        
        // Input file change listener
        document.getElementById('nueva-prenda-tela-imagen').addEventListener('change', function(e) {
            window.manejarImagenTela(this);
        });
        
        // Log inicial
        console.log('ðŸš€ Test page loaded. telasAgregadas:', window.telasAgregadas);
    </script>
</body>
</html>
