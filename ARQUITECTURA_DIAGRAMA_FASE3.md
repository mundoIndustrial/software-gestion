# ğŸ—ï¸ DIAGRAMA ARQUITECTURA - FASE 3 COMPLETADA

## Arquitectura de Capas - DDD Event-Driven

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           HTTP LAYER                                â”‚
â”‚  Request â†’ PedidosProduccionController â†’ Response                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       APPLICATION LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LogoPedidoServiceâ”‚  â”‚PrendaCreation    â”‚  â”‚ [Other Services] â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚Service           â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ â€¢ guardarDatos() â”‚  â”‚ â€¢ crearPrenda*() â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ â€¢ Emit events    â”‚  â”‚ â€¢ Emit events    â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â†“                   â†“          DOMAIN LAYER                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚  Repositories    â”‚  â”‚  Aggregates      â”‚                         â”‚
â”‚  â”‚ (Data Access)    â”‚  â”‚ (Invariants)     â”‚                         â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚                         â”‚
â”‚  â”‚ â€¢ LogoPedido*    â”‚  â”‚ â€¢ PedidoProducciÃ³nâ”‚                        â”‚
â”‚  â”‚ â€¢ Prenda*        â”‚  â”‚ â€¢ PrendaPedido   â”‚                         â”‚
â”‚  â”‚ â€¢ Logo*          â”‚  â”‚ â€¢ LogoPedido     â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Strategies       â”‚  â”‚ Value Objects    â”‚  â”‚ Enums            â”‚  â”‚
â”‚  â”‚ (Algorithms)     â”‚  â”‚ (Immutable)      â”‚  â”‚ (Constants)      â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ â€¢ CreacionPrenda â”‚  â”‚ [Future]         â”‚  â”‚ EstadoPedido     â”‚  â”‚
â”‚  â”‚   SinCta         â”‚  â”‚                  â”‚  â”‚ TipoNotificacion â”‚  â”‚
â”‚  â”‚ â€¢ CreacionPrenda â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚   Reflectivo     â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOMAIN EVENT DISPATCHER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DomainEventDispatcher (Observer Pattern)                  â”‚   â”‚
â”‚  â”‚  â”œâ”€ subscribe(eventClass, listener)                        â”‚   â”‚
â”‚  â”‚  â”œâ”€ dispatch(event)                                        â”‚   â”‚
â”‚  â”‚  â””â”€ getPendingEvents()                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“        â†“        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚Events â”‚ â”‚Eventsâ”‚ â”‚Events â”‚
    â”‚   1   â”‚ â”‚  2   â”‚ â”‚   3   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜

        PedidoProduccionCreado
        PrendaPedidoAgregada
        LogoPedidoCreado
        PedidoProduccionCompletado


        â†“        â†“        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  APPLICATION LAYER                       â”‚
â”‚                   EVENT LISTENERS                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ NotificarCliente â”‚  â”‚ActualizarCache   â”‚             â”‚
â”‚  â”‚PedidoCreado      â”‚  â”‚Pedidos           â”‚             â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚             â”‚
â”‚  â”‚ â€¢ Send email     â”‚  â”‚ â€¢ Invalidate     â”‚             â”‚
â”‚  â”‚ â€¢ Send SMS       â”‚  â”‚   cache keys     â”‚             â”‚
â”‚  â”‚ â€¢ Notify Whatsappâ”‚  â”‚ â€¢ Update stats   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚RegistrarAuditoriaâ”‚  â”‚ActualizarEstadis â”‚             â”‚
â”‚  â”‚Pedido            â”‚  â”‚ticas Prendas     â”‚             â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚             â”‚
â”‚  â”‚ â€¢ Log to DB      â”‚  â”‚ â€¢ Update stats   â”‚             â”‚
â”‚  â”‚ â€¢ Compliance     â”‚  â”‚ â€¢ Track trends   â”‚             â”‚
â”‚  â”‚ â€¢ Trail          â”‚  â”‚ â€¢ Cache updates  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“        â†“        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        INFRASTRUCTURE LAYER                   â”‚
â”‚  â€¢ Database                                   â”‚
â”‚  â€¢ Cache (Redis)                              â”‚
â”‚  â€¢ Notifications (Email, SMS)                 â”‚
â”‚  â€¢ Logging                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de Eventos - Secuencia

### Escenario 1: Crear Pedido

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONTROLLER  â”‚ POST /pedidos/crear
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PedidoProduccionService  â”‚ crearPedido($data)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PedidoProduccionAggregateâ”‚ ::crear($data)
â”‚ â€¢ Validar invariantes    â”‚
â”‚ â€¢ Crear pedido en BD     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ Emite Evento
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PedidoProduccionCreado   â”‚ new PedidoProduccionCreado(...)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ Dispatch
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DomainEventDispatcher                      â”‚
â”‚   dispatch(PedidoProduccionCreado)           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â†’ NotificarClientePedidoCreado()
       â”‚    â€¢ sendEmail(cliente)
       â”‚    â€¢ sendSMS(asesor)
       â”‚    â€¢ updateNotificationLog()
       â”‚
       â”œâ”€â”€â†’ ActualizarCachePedidos()
       â”‚    â€¢ Cache::forget('pedidos_*')
       â”‚    â€¢ Cache::forget('reportes_*')
       â”‚
       â””â”€â”€â†’ RegistrarAuditoriaPedido()
            â€¢ AuditoriaTable::log(...)
            â€¢ compliance check
```

### Escenario 2: Agregar Prenda

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONTROLLER  â”‚ POST /pedidos/:id/prendas
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PrendaCreationService    â”‚ crearPrendaSinCotizacion($data)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CreacionPrendaSinCtaStratâ”‚ procesar($data)
â”‚ â€¢ Procesar cantidades    â”‚
â”‚ â€¢ Crear variantes        â”‚
â”‚ â€¢ Insertar en BD         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ Emite Evento
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PrendaPedidoAgregada     â”‚ new PrendaPedidoAgregada(...)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ Dispatch
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DomainEventDispatcher                      â”‚
â”‚   dispatch(PrendaPedidoAgregada)             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â”€â†’ ActualizarEstadisticasPrendas()
            â€¢ Cache::forget('pedido_{id}_prendas')
            â€¢ Cache::increment('prendas_tipo_*')
            â€¢ updateDailyStats()
```

---

## Mapeo de Responsabilidades

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER                  â”‚ RESPONSIBILITY           â”‚ EXAMPLES    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HTTP/Controller        â”‚ â€¢ Parse request          â”‚ validate,   â”‚
â”‚                        â”‚ â€¢ Generate response      â”‚ respond     â”‚
â”‚                        â”‚ â€¢ Route handling         â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Application/Services   â”‚ â€¢ Orquestar workflows    â”‚ orchestrate â”‚
â”‚                        â”‚ â€¢ Inyectar dependencias  â”‚ coordinate  â”‚
â”‚                        â”‚ â€¢ Emitir eventos        â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Domain/Aggregates      â”‚ â€¢ Proteger invariantes   â”‚ business    â”‚
â”‚                        â”‚ â€¢ Encapsular lÃ³gica      â”‚ rules       â”‚
â”‚                        â”‚ â€¢ Emitir cambios         â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Domain/Strategies      â”‚ â€¢ Encapsular algoritmos  â”‚ algorithms  â”‚
â”‚                        â”‚ â€¢ Ser intercambiables    â”‚ tactics     â”‚
â”‚                        â”‚ â€¢ Variar comportamiento  â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Domain/Events          â”‚ â€¢ Capturar cambios       â”‚ facts       â”‚
â”‚                        â”‚ â€¢ Ser inmutables         â”‚ records     â”‚
â”‚                        â”‚ â€¢ Ser serializables      â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Application/Listeners  â”‚ â€¢ Manejar lado effects   â”‚ notifications
â”‚                        â”‚ â€¢ Mantener consistency   â”‚ cache       â”‚
â”‚                        â”‚ â€¢ Logging/auditing       â”‚ audit       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Infrastructure/Repos   â”‚ â€¢ Acceso a datos         â”‚ queries     â”‚
â”‚                        â”‚ â€¢ Persistencia           â”‚ persistence â”‚
â”‚                        â”‚ â€¢ AbstracciÃ³n de BD      â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Infrastructure/I/O     â”‚ â€¢ Database               â”‚ MySQL       â”‚
â”‚                        â”‚ â€¢ Cache                  â”‚ Redis       â”‚
â”‚                        â”‚ â€¢ Notifications          â”‚ Email/SMS   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Dependencias - InyecciÃ³n

```
EventServiceProvider (singleton setup)
    â”œâ”€ DomainEventDispatcher
    â”‚  â”œâ”€ LaravelDispatcher (Laravel's event dispatcher)
    â”‚  â””â”€ Listeners registry
    â”‚
    â”œâ”€ LogoPedidoService
    â”‚  â”œâ”€ DomainEventDispatcher (injected)
    â”‚  â”œâ”€ NumeracionService
    â”‚  â”œâ”€ LogoPedidoRepository
    â”‚  â””â”€ Emits LogoPedidoCreado
    â”‚
    â””â”€ PrendaCreationService
       â”œâ”€ DomainEventDispatcher (injected)
       â”œâ”€ DescripcionService
       â”œâ”€ ImagenService
       â”œâ”€ UtilitariosService
       â””â”€ Emits PrendaPedidoAgregada
```

---

## PatrÃ³n Observer - Detallado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    DomainEventDispatcher        â”‚ (Subject)
â”‚                                 â”‚
â”‚  listeners = {}                 â”‚
â”‚  pendingEvents = []             â”‚
â”‚                                 â”‚
â”‚  â€¢ subscribe()                  â”‚
â”‚  â€¢ dispatch()                   â”‚
â”‚  â€¢ getPendingEvents()           â”‚
â”‚  â€¢ clearPendingEvents()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚           â”‚           â”‚
     â†“           â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Listener â”‚ â”‚Listener  â”‚ â”‚Listener  â”‚
â”‚    1    â”‚ â”‚    2     â”‚ â”‚    3     â”‚
â”‚(Update) â”‚ â”‚(Notify)  â”‚ â”‚(Audit)   â”‚
â”‚         â”‚ â”‚          â”‚ â”‚          â”‚
â”‚ notify()â”‚ â”‚ notify() â”‚ â”‚ notify() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚            â”‚
    â”œâ”€ Mail     â”œâ”€ Cache    â””â”€ Database
    â””â”€ SMS      â””â”€ Stats
```

---

## Event Flow - De Punta a Punta

```
INICIO: Usuario hace POST /pedidos/1/prendas

    CONTROLLER
    â”œâ”€ Validates HTTP request
    â””â”€ Calls PrendaCreationService::crearPrendaSinCotizacion()
            â”‚
            â”œâ”€ Inyecta dependencias
            â”œâ”€ Llama strategy::procesar()
            â”‚   â”œâ”€ Valida datos
            â”‚   â”œâ”€ Procesa cantidades
            â”‚   â”œâ”€ Crea prendaPedido
            â”‚   â””â”€ Retorna objeto
            â”‚
            â”œâ”€ Crea evento PrendaPedidoAgregada
            â”‚   â””â”€ new PrendaPedidoAgregada(
            â”‚       pedidoId: 123,
            â”‚       prendaId: 456,
            â”‚       nombrePrenda: "Camiseta",
            â”‚       cantidad: 50,
            â”‚       ...
            â”‚     )
            â”‚
            â”œâ”€ Dispatch evento
            â”‚   â””â”€ $dispatcher->dispatch($event)
            â”‚       â”‚
            â”‚       â”œâ”€ EventDispatcher::dispatch()
            â”‚       â”‚   â””â”€ Itera listeners
            â”‚       â”‚
            â”‚       â””â”€ Ejecuta listeners sÃ­ncronamente
            â”‚
            â”œâ”€ Listener 1: ActualizarEstadisticasPrendas
            â”‚   â”œâ”€ Cache::forget('pedido_123_prendas')
            â”‚   â”œâ”€ Cache::increment('prendas_camiseta', 50)
            â”‚   â””â”€ Redis: actualizar contadores
            â”‚
            â””â”€ Retorna prenda creada

    RESPONSE: JSON con prenda creada
```

---

## Event Lifecycle

```
STATE 1: CreaciÃ³n
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ new LogoPedidoCreado() â”‚
â”‚                        â”‚
â”‚ â€¢ pedidoId = 123       â”‚
â”‚ â€¢ logoPedidoId = 456   â”‚
â”‚ â€¢ cantidad = 10        â”‚
â”‚ â€¢ timestamp: now()     â”‚
â”‚ â€¢ eventId: uuid()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STATE 2: Dispatch
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ eventDispatcher->      â”‚
â”‚   dispatch($event)     â”‚
â”‚                        â”‚
â”‚ [Event in queue]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STATE 3: Listeners Ejecutando
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For each listener of this type:â”‚
â”‚                                â”‚
â”‚ try {                          â”‚
â”‚   listener->__invoke($event)   â”‚
â”‚ } catch (Exception) {          â”‚
â”‚   Log & continue               â”‚
â”‚ }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STATE 4: Persistencia (Optional)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ evento_guardado en DB:         â”‚
â”‚                                â”‚
â”‚ event_id | type | data | at    â”‚
â”‚ 123      | Logo | ...  | now() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STATE 5: Completo
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Evento procesado    â”‚
â”‚ âœ… Todos listeners OK  â”‚
â”‚ âœ… Efectos aplicados   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Componentes por UbicaciÃ³n

```
app/
â”œâ”€ Domain/
â”‚  â”œâ”€ Shared/
â”‚  â”‚  â”œâ”€ DomainEvent.php ........................ Base class
â”‚  â”‚  â””â”€ DomainEventDispatcher.php ............. Gestor
â”‚  â”‚
â”‚  â””â”€ PedidoProduccion/
â”‚     â”œâ”€ Events/ ............................... 4 eventos
â”‚     â”‚  â”œâ”€ PedidoProduccionCreado.php
â”‚     â”‚  â”œâ”€ PrendaPedidoAgregada.php
â”‚     â”‚  â”œâ”€ LogoPedidoCreado.php
â”‚     â”‚  â””â”€ PedidoProduccionCompletado.php
â”‚     â”‚
â”‚     â”œâ”€ Aggregates/ ........................... 3 agregados
â”‚     â”‚  â”œâ”€ PedidoProduccionAggregate.php
â”‚     â”‚  â”œâ”€ PrendaPedidoAggregate.php
â”‚     â”‚  â””â”€ LogoPedidoAggregate.php
â”‚     â”‚
â”‚     â”œâ”€ Listeners/ ........................... 4 listeners
â”‚     â”‚  â”œâ”€ NotificarClientePedidoCreado.php
â”‚     â”‚  â”œâ”€ ActualizarCachePedidos.php
â”‚     â”‚  â”œâ”€ RegistrarAuditoriaPedido.php
â”‚     â”‚  â””â”€ ActualizarEstadisticasPrendas.php
â”‚     â”‚
â”‚     â”œâ”€ Services/ ........................... (actualizados)
â”‚     â”‚  â”œâ”€ LogoPedidoService.php (con events)
â”‚     â”‚  â”œâ”€ PrendaCreationService.php (con events)
â”‚     â”‚  â””â”€ ...
â”‚     â”‚
â”‚     â”œâ”€ Repositories/ ....................... (FASE 1)
â”‚     â”‚  â”œâ”€ LogoPedidoRepository.php
â”‚     â”‚  â””â”€ ...
â”‚     â”‚
â”‚     â””â”€ Strategies/ ......................... (FASE 2)
â”‚        â”œâ”€ CreacionPrendaStrategy.php
â”‚        â”œâ”€ CreacionPrendaSinCtaStrategy.php
â”‚        â””â”€ CreacionPrendaReflectivoStrategy.php
â”‚
â”œâ”€ Providers/
â”‚  â””â”€ EventServiceProvider.php ................ (actualizado)
â”‚
â””â”€ Http/Controllers/
   â””â”€ Asesores/
      â””â”€ PedidosProduccionController.php ....... (refactorizado)
```

---

## MÃ©tricas Finales

```
Componentes:
â”œâ”€ Clases: 19 nuevas + 3 modificadas = 22 total
â”œâ”€ Interfaces: 1 (CreacionPrendaStrategy)
â”œâ”€ Eventos: 4
â”œâ”€ Agregados: 3
â”œâ”€ Listeners: 4
â”œâ”€ Servicios: 2+ actualizados
â””â”€ Providers: 1 actualizado

LÃ­neas de CÃ³digo:
â”œâ”€ Nuevas: 1,215+
â”œâ”€ Refactorizadas: 520+
â”œâ”€ Totales en proyecto: +695
â””â”€ Complexity reducida: 80%

Validaciones:
â”œâ”€ Archivos PHP: 25
â”œâ”€ Errores: 0
â”œâ”€ Warnings: 0
â””â”€ Status: âœ… PASS

Patrones:
â”œâ”€ Strategy Pattern: 2 implementaciones
â”œâ”€ Factory Pattern: 3 agregados
â”œâ”€ Observer Pattern: 1 dispatcher
â”œâ”€ Repository Pattern: 2+ repositorios
â””â”€ DDD Patterns: Eventos + Agregados
```

---

**Ãšltima actualizaciÃ³n**: [Timestamp actual]
**Estado**: âœ… ARQUITECTURA COMPLETA
**PrÃ³ximo**: FASE 4 - CQRS
