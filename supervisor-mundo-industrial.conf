# Configuración Supervisor para Mundo Industrial
# Ubicar en: /etc/supervisor/conf.d/mundo-industrial.conf
#
# Comandos útiles:
# supervisorctl reread          - Recargar configuración
# supervisorctl update          - Actualizar procesos
# supervisorctl restart all     - Reiniciar todos
# supervisorctl status          - Ver estado
# supervisorctl tail laravel    - Ver logs
# supervisorctl tail queue      - Ver logs queue
# supervisorctl tail reverb     - Ver logs reverb

[group:mundo-industrial]
programs=laravel,queue,reverb
priority=999

# ============================================
# LARAVEL APPLICATION
# ============================================
[program:laravel]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sistemamundoindustrial/artisan octane:start --server=swoole --host=127.0.0.1 --port=8000 --workers=4
autostart=true
autorestart=true
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/laravel.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=10
stderr_logfile=/var/log/supervisor/laravel-error.log
user=www-data
environment=PATH="/usr/local/bin:/usr/bin:/bin",USER="www-data",HOME="/var/www"
stopwaitsecs=3600
stopasgroup=true

# ============================================
# QUEUE WORKER - COTIZACIONES
# ============================================
[program:queue]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sistemamundoindustrial/artisan queue:work --queue=cotizaciones,default --tries=1 --timeout=86400 --sleep=3 --memory=512
autostart=true
autorestart=true
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/queue.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=10
stderr_logfile=/var/log/supervisor/queue-error.log
user=www-data
environment=PATH="/usr/local/bin:/usr/bin:/bin",USER="www-data",HOME="/var/www"
stopwaitsecs=3600
stopasgroup=true

# ============================================
# LARAVEL REVERB - WEBSOCKET SERVER
# ============================================
[program:reverb]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/sistemamundoindustrial/artisan reverb:start --host=0.0.0.0 --port=8080
autostart=true
autorestart=true
numprocs=1
redirect_stderr=true
stdout_logfile=/var/log/supervisor/reverb.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=10
stderr_logfile=/var/log/supervisor/reverb-error.log
user=www-data
environment=PATH="/usr/local/bin:/usr/bin:/bin",USER="www-data",HOME="/var/www"
stopwaitsecs=10
stopasgroup=true
