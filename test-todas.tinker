// Obtener el usuario yus2
$user = App\Models\User::where('name', 'yus2')->first();
if (!$user) {
    echo "âŒ Usuario yus2 no encontrado\n";
    exit;
}

$userId = $user->id;
echo "ğŸ‘¤ Usuario: {$user->name} (ID: {$userId})\n\n";

$allCotizaciones = App\Models\Cotizacion::where('user_id', $userId)
    ->where('es_borrador', false)
    ->with('tipoCotizacion', 'usuario', 'prendasCotizaciones', 'prendaCotizacion', 'logoCotizacion')
    ->orderBy('created_at', 'desc')
    ->get();

echo "ğŸ“Š Total de cotizaciones: {$allCotizaciones->count()}\n\n";

// Filtrar por tipo
$cotPrendaCollection = $allCotizaciones->filter(fn($c) => $c->obtenerTipoCotizacion() === 'P');
$cotLogoCollection = $allCotizaciones->filter(fn($c) => $c->obtenerTipoCotizacion() === 'B');
$cotPBCollection = $allCotizaciones->filter(fn($c) => $c->obtenerTipoCotizacion() === 'PB');

echo "ğŸ“ˆ Desglose:\n";
echo "- Prenda (P): {$cotPrendaCollection->count()}\n";
echo "- Logo (B): {$cotLogoCollection->count()}\n";
echo "- Prenda/Bordado (PB): {$cotPBCollection->count()}\n\n";

// Combinar como lo hace el controlador
$allCotizacionesCollection = $cotPrendaCollection->merge($cotLogoCollection)->merge($cotPBCollection)->sortByDesc('created_at')->values();

echo "ğŸ“‹ COLECCIÃ“N COMBINADA (Todas):\n";
echo "Total: {$allCotizacionesCollection->count()}\n\n";

echo "Contenido:\n";
foreach ($allCotizacionesCollection as $index => $cot) {
    echo "{$index}. ID: {$cot->id} | CÃ³digo: {$cot->numero_cotizacion} | Tipo: " . $cot->obtenerTipoCotizacion() . " | Cliente: {$cot->cliente}\n";
}
